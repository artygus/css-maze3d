<!doctype html>
<html>
<head>
  <script src="../lib/camera.js"></script>
  <script src="../lib/renderer.js"></script>
  <link rel="stylesheet" href="./textures.css" />
  <style>
    #viewport {
      background: #000;
      position: relative;
    }
  </style>
</head>
<body style="margin:0">
  <div id="viewport">
    <div id="camera">
      <div id="world"></div>
    </div>
  </div>

  <script>
    var worldEl = document.getElementById('world'),
        cameraEl = document.getElementById('camera'),
        viewportEl = document.getElementById('viewport'),
        renderGod = new Renderer(worldEl, 100);

    renderGod.cells([
      {
        x: 0, y: 0,
        n: {type: 'wall', face: 'black-wall'},
        e: {type: 'wall', face: 'black-wall'},
        w: {type: 'wall', face: 'black-wall'}
      }, {
        x: 0, y: 1,
        w: {type: 'wall', face: 'black-wall'}
      }, {
        x: 1, y: 1,
        n: {type: 'wall', face: 'black-wall'},
        e: {type: 'wall', face: 'white-wall'},
        s: {type: 'wall', face: 'black-wall'}
      }, {
        x: 0, y: 2,
        e: {type: 'wall', face: 'black-wall'},
        w: {type: 'wall', face: 'black-wall'}
      }, {
        x: 0, y: 3,
        e: {type: 'wall', face: 'black-wall'},
        s: {type: 'wall', face: 'black-wall'},
        w: {type: 'wall', face: 'black-wall'}
      }
    ]);

    // camera
    var camera = new Camera(viewportEl, worldEl, window.innerWidth, window.innerHeight, cameraEl, 100),
        coords = [0, 0];

    camera.set(coords, 's');

    // free camera
    var mx = 0,
        my = 0;

    document.addEventListener("mouseover", function(ev) {
      mx = ev.pageX;
      my = ev.pageY;
      document.removeEventListener("mouseover", arguments.callee)
    }, false);

    document.addEventListener("mousemove", function(ev) {
      camera.rotate(-(ev.pageY - my) / 2, -(ev.pageX - mx) / 2);
      mx = ev.pageX;
      my = ev.pageY;
    }, false);

    // keyboard
    document.addEventListener("keyup", function(e) {
      var course;

      switch (e.keyCode) {
        case 83:
          course = 'f';
          break;
        case 68:
          course = 'r';
          break;
        case 87:
          course = 'b';
          break;
        case 65:
          course = 'l';
          break;
        default:
          return false;
      }

      var nCoords = camera.getNextCell(coords[0], coords[1], course);

      if (true/* check for collisions */) {
        camera.setCell(nCoords[0], nCoords[1]);
        camera.update();
        coords = nCoords;
      }
    }, false);
  </script>
</body>
</html
