<!doctype html>
<html>
<head>
  <script src="../lib/camera.js"></script>
  <script src="../lib/renderer.js"></script>
  <link rel="stylesheet" href="./textures.css" />
  <style>
    #viewport {
      background: #000;
      position: relative;
    }
  </style>
</head>
<body style="margin:0">
  <div id="viewport">
    <div id="camera">
      <div id="world"></div>
    </div>
  </div>

  <script>
    var worldEl = document.getElementById('world'),
        cameraEl = document.getElementById('camera'),
        viewportEl = document.getElementById('viewport'),
        renderGod = new Renderer(worldEl, 100);

    renderGod.wall([0,0], 'n', 'wall');

    renderGod.wall([0,0], 'e', 'wall');
    renderGod.wall([0,0], 'w', 'wall');

    renderGod.wall([0,1], 'w', 'wall');

    renderGod.wall([1,1], 'n', 'wall');
    renderGod.wall([1,1], 's', 'wall');
    renderGod.wall([1,1], 'e', 'wall');

    renderGod.wall([0,2], 'e', 'wall');
    renderGod.wall([0,2], 'w', 'wall');

    renderGod.wall([0,3], 'e', 'wall');
    renderGod.wall([0,3], 'w', 'wall');

    renderGod.wall([0,3], 's', 'wall');

    // camera
    var camera = new Camera(viewportEl, worldEl, window.innerWidth, window.innerHeight, cameraEl, 100),
        coords = [0, 0],
        directions = ['n', 'w', 's', 'e'],
        directionIndex = 2;

    camera.set(coords, directions[directionIndex]);

    // free camera
    var mx = 0,
        my = 0;

    document.addEventListener("mouseover", function(ev) {
      mx = ev.pageX;
      my = ev.pageY;
      document.removeEventListener("mouseover", arguments.callee)
    }, false);

    document.addEventListener("mousemove", function(ev) {
      camera.rotate(-(ev.pageY - my) / 2, -(ev.pageX - mx) / 2);
      camera.update();
      mx = ev.pageX;
      my = ev.pageY;
    }, false);

    // keyboard
    function cycle(array, index) {
      return array[index % array.length];
    }

    document.addEventListener("keyup", function(e) {
      switch (e.keyCode) {
        case 83:
          coords[1]--;
          break;
        case 65:
          coords[0]++;
          break;
        case 87:
          coords[1]++;
          break;
        case 68:
          coords[0]--;
          break;
        case 81:
          directionIndex--;
          camera.setDirection(cycle(directions, directionIndex));
          break;
        case 69:
          directionIndex++;
          camera.setDirection(cycle(directions, directionIndex));
          break;
        default:
          return false;
      }

      camera.setCell(coords[0], coords[1]);
      camera.update();
    }, false);
  </script>
</body>
</html
